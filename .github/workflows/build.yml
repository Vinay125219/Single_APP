name: Build Executable for RHEL7.9

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:   # allow manual run

jobs:
  build:
    runs-on: ubuntu-latest   # use modern runner
    steps:
      - uses: actions/checkout@v4

      - name: Build in CentOS7 container
        run: |
          docker run --rm -v "$PWD":/src centos:7 /bin/bash -c "
            yum -y install epel-release &&
            yum -y install python36 python36-devel gcc make which &&
            python3.6 -m ensurepip &&
            python3.6 -m pip install --upgrade pip pyinstaller &&
            cd /src &&
            python3.6 -m PyInstaller --onefile main.py
          "

      - name: Upload Executable
        uses: actions/upload-artifact@v4
        with:
          name: device-monitor-rhel7
          path: dist/main
